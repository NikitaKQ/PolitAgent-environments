# Tofu Kingdom

Игра "Tofu Kingdom" представляет собой дедуктивную игру, где Принц должен определить, кто из игроков является Принцессой, основываясь на ответах других персонажей, которые либо говорят правду, либо лгут в зависимости от своей роли.

## Роли

В игре 8 ролей:
- **Принц** - должен угадать, кто из игроков является Принцессой
- **Принцесса** - всегда говорит правду
- **Шеф-повар** - всегда говорит правду
- **Королева** - всегда лжет
- **Министр** - всегда лжет
- **Стражник** - всегда лжет
- **Горничная** - может говорить правду или лгать
- **Шпион** - может говорить правду или лгать

## Команды

Роли объединены в команды:
- **Команда Принцессы**: Принцесса и Шеф-повар
- **Команда Королевы**: Королева, Министр, Стражник
- **Нейтральная команда**: Горничная и Шпион

## Условия победы

- Если Принц выбирает Принцессу, выигрывает команда Принцессы
- Если Принц выбирает Королеву, выигрывает команда Королевы
- Если Принц выбирает любую другую роль, выигрывает Нейтральная команда

## Архитектура 

### Новая архитектура (после рефакторинга)

Основные компоненты:

1. **GameController** (`agents/game_controller.py`) - центральный контроллер игры:
   - Управляет состоянием игры
   - Делегирует задачи агентам
   - Обрабатывает раунды вопросов и ответов
   - Определяет победителей

2. **RoleAgent** (`agents/role_agent.py`) - унифицированный агент для всех ролей кроме Принца:
   - Поддерживает все роли, кроме Принца
   - Определяет поведение в зависимости от роли (правда/ложь/выбор)
   - Содержит информацию о принадлежности к команде

3. **PrinceAgent** (`agents/prince_agent.py`) - специализированный агент для Принца:
   - Задает вопросы другим игрокам
   - Обрабатывает полученную информацию
   - Делает финальный выбор Принцессы

4. **TofuKingdomGame** (`refactored_game.py`) - основной класс игры:
   - Интегрируется с внешней игровой системой
   - Делегирует игровую логику контроллеру 

### Старая архитектура (до рефакторинга)

Архитектура до рефакторинга содержала отдельный класс для каждой роли и смешивала логику игры с логикой агентов.

## Обратная совместимость

Для обеспечения обратной совместимости:
- В `__init__.py` экспортируются классы старых агентов, которые на самом деле создают новые унифицированные агенты
- Доступны как новая (`RefactoredTofuKingdomGame`), так и старая (`LegacyTofuKingdomGame`) версии игры

## Использование

```python
from environments.tofukingdom import TofuKingdomGame

# Создание игры с моделями для разных команд
game = TofuKingdomGame(
    args,
    prince_llm=prince_model,
    princess_llm=princess_team_model,
    queen_llm=queen_team_model,
    neutral_llm=neutral_team_model
)

# Инициализация игры
game.init_game()

# Запуск игрового цикла
with open("game_log.txt", "w") as log_file:
    results = game.game_loop(log_file)

print(f"Победитель: {results['winner_team']}") 